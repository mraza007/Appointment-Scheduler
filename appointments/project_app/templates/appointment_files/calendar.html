{% extends 'appointment_files/base.html' %}

{% block title %}Calendar - Appointments App{% endblock %}

{% block extra_css %}
<style>
    .calendar-table {
        table-layout: fixed;
    }
    .calendar-table th,
    .calendar-table td {
        width: 14.28%;
        height: 100px;
        vertical-align: top;
        padding: 5px;
    }
    .calendar-table td {
        border: 1px solid #dee2e6;
    }
    .calendar-day {
        font-weight: bold;
        margin-bottom: 5px;
    }
    .calendar-today {
        background-color: #e3f2fd;
    }
    .calendar-empty {
        background-color: #f8f9fa;
    }
    .appointment-dot {
        display: inline-block;
        width: 100%;
        padding: 2px 5px;
        margin-bottom: 2px;
        font-size: 0.75rem;
        border-radius: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
    }
    .appointment-dot.pending { background-color: #fff3cd; color: #856404; }
    .appointment-dot.confirmed { background-color: #d4edda; color: #155724; }
    .appointment-dot.completed { background-color: #d1ecf1; color: #0c5460; }
    .appointment-dot.cancelled { background-color: #f8d7da; color: #721c24; }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-calendar-alt"></i> Calendar</h2>
    {% if user.is_authenticated %}
    <a href="{% url 'post_new' %}" class="btn btn-success">
        <i class="fas fa-plus"></i> New Appointment
    </a>
    {% endif %}
</div>

<div class="card">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <a href="?year={{ prev_year }}&month={{ prev_month }}" class="btn btn-outline-primary">
                <i class="fas fa-chevron-left"></i> Previous
            </a>
            <h4 class="mb-0">{{ month_name }} {{ year }}</h4>
            <a href="?year={{ next_year }}&month={{ next_month }}" class="btn btn-outline-primary">
                Next <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </div>
    <div class="card-body p-0">
        <table class="table table-bordered calendar-table mb-0">
            <thead class="thead-light">
                <tr>
                    <th class="text-center">Sun</th>
                    <th class="text-center">Mon</th>
                    <th class="text-center">Tue</th>
                    <th class="text-center">Wed</th>
                    <th class="text-center">Thu</th>
                    <th class="text-center">Fri</th>
                    <th class="text-center">Sat</th>
                </tr>
            </thead>
            <tbody>
                {% for week in month_days %}
                <tr>
                    {% for day in week %}
                    {% if day == 0 %}
                    <td class="calendar-empty"></td>
                    {% else %}
                    <td class="{% if today.year == year and today.month == month and today.day == day %}calendar-today{% endif %}">
                        <div class="calendar-day">{{ day }}</div>
                        {% if day in appointments_by_date %}
                            {% for appt in appointments_by_date|default_if_none:"" %}
                                {% if appt.date_field.day == day %}
                                <a href="{% url 'appointmentsdetail' appt.pk %}"
                                   class="appointment-dot {{ appt.status }}"
                                   title="{{ appt.appointment_title }} - {{ appt.time_field|time:'g:i A' }}">
                                    {{ appt.appointment_title }}
                                </a>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        {% for appt in appointments_by_date %}
                            {% if appt == day %}
                                {% for appointment in appointments_by_date|default_if_none:"" %}
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="mt-4">
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-info-circle"></i> Legend</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <span class="badge badge-warning">Pending</span>
                    <small class="text-muted ml-2">Awaiting confirmation</small>
                </div>
                <div class="col-md-3">
                    <span class="badge badge-success">Confirmed</span>
                    <small class="text-muted ml-2">Appointment confirmed</small>
                </div>
                <div class="col-md-3">
                    <span class="badge badge-info">Completed</span>
                    <small class="text-muted ml-2">Already completed</small>
                </div>
                <div class="col-md-3">
                    <span class="badge badge-danger">Cancelled</span>
                    <small class="text-muted ml-2">Appointment cancelled</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="{% url 'view' %}" class="btn btn-secondary">
        <i class="fas fa-list"></i> List View
    </a>
    <a href="{% url 'index' %}" class="btn btn-outline-secondary">
        <i class="fas fa-home"></i> Home
    </a>
</div>
{% endblock %}
